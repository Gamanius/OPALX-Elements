\documentclass[a4paper]{book}

\input{packages}
\input{switches}
\input{macros}

%----Control Structures
\newboolean{FullOPALManual}
\setboolean{FullOPALManual}{true}

%Trick to allow for individual document creation with header.tex
%Define dummy command:
\newcommand{\buildingFullOPALManual}[1]{\def\@buildingFullOPALManual{#1}}
\buildingFullOPALManual{}


\makeindex

\bibliography{bibliography}

\begin{document}

\begin{titlepage}

\begin{htmlonly}
\begin{rawhtml}
<center>
PAUL SCHERRER INSTITUT
<br>
<h1>The OPAL Framework , \opalversion{} \footnote{Release Date: Not yet released!}</h1>
<h2>(Object Oriented Parallel Accelerator Library)</h2>
<h2>User's Reference Manual</h2>
<br>
Andreas Adelmann, Achim Gsell, Valeria Rizzoglio (PSI)\\ Christof Metzger-Kraus (HZB), \\ Yves Ineichen (IBM),\\ Xiaoying Pang, Steve Russell (LANL),\\ Chuan Wang, Jianjun Yang (CIAE), \\  Suzanne Sheehy, Chris Rogers (RAL) and \\ Daniel Winklehner (MIT)
</center>
\end{rawhtml}
\end{htmlonly}

\begin{latexonly}
\begin{center}\normalsize
\includegraphics[width=1.\linewidth,angle=0]{figures/psi_logo_wide}
\end{center}
\vskip 0.7cm
PSI-PR-08-02

%% \begin{flushright}
%% \documentlabel \\                    % document label
%% \end{flushright}
%% \vskip 2.3cm
\begin{center}\LARGE                 % document title
{\bf The OPAL Framework } \\
(Object Oriented Parallel Accelerator Library) \\
\opalversion{} \\
(compiled \today)\\
{\bf User's Reference Manual}
\end{center}
\vskip 1.5em
\begin{center}                       % author
Andreas Adelmann, Achim Gsell, Valeria Rizzoglio (PSI),\\ Christof Metzger-Kraus (HZB), \\ Yves Ineichen (IBM),\\ Xiaoying Pang, Steve Russell (LANL),\\ Chuan Wang, Jianjun Yang (CIAE), \\ Suzanne Sheehy, Chris Rogers (RAL) and \\ Daniel Winklehner (MIT)
\vskip 2em
{\large Abstract}
\end{center}
\end{latexonly}

\begin{quotation}
\opal is a tool for charged-particle optics in
accelerator structures and beam lines.
Using the \mad language with extensions, \opal is derived from \madninep and is based
on the \classic class library,
which was started in 1995 by an international collaboration. IPPL (Independent Parallel Particle Layer) is
the framework which provides parallel particles and fields using data parallel ansatz.
\opal is built from the ground up as a parallel application exemplifying the fact that HPC (High Performance Computing)
is the third leg of science, complementing theory and the experiment.
HPC is made possible now through the increasingly sophisticated mathematical models and evolving computer power available on the desktop
and in super computer centres. \opal runs on your laptop as well as on the largest HPC clusters available today.

The \opal framework makes it easy to add new features in the form of new
\texttt{C++}~classes. It comes in the following flavours:
\begin{description}
\item[\opalcycl] tracks particles with 3D space charge including neighbouring turns in cyclotrons and FFAG's
with time as the independent variable.
\item[\opalt] can be used to model beam lines, linacs, rf-photo injectors and complete XFEL's excluding the undulator.

\end{description}
It should be noted that not all features of \opal are available in all flavours. The icon \noopalt means that a feature is not yet
available in \opalt. Similar icons are used for the other flavours.

%\begin{itemize}
%\item \opalmap (\latermore)
%\item \opalcycl
%\item \opalt
%\item \opaline
%\end{itemize}

%\opalmap tracks particles with 3D space charge using split operator techniques, and is a proper subset of \madninep. In the future
%a linear space charge mode will become available available
%allowing the user to track moments of the distribution.

\end{quotation}
\vfill
%\begin{center}
%Villigen, Switzerland
%\today
%\end{center}
\end{titlepage}
\thispagestyle{empty}

\frontmatter
\tableofcontents
\listoftables
\listoffigures
\mainmatter
\include{introduction}          % ch 1
\include{conventions}           % ch 2
\include{tutorial}              % ch 3
\include{opalt}                 % ch 4
\include{opalcycl}              % ch 5
\ifthenelse{\boolean{ShowEnv}}{\include{opale}}{}
\include{format}                % ch 6
\include{control}               % ch 7
\include{elements}              % ch 8
\include{lines}                 % ch 9
\include{physics}               % ch 10
\include{distribution}          % ch 11
\include{fieldsolvers}          % ch 12
\include{track}                 % ch 13
\include{wakefields}            % ch 14
\include{geometry}              % ch 15
\include{fieldemission}         % ch 16
\include{multipact}             % ch 17
\include{partmatter}            % ch 18

%opal-map
\ifthenelse{\boolean{ShowMap}}{
  \include{opal-flavours}        % ch 4
  \include{opalmap}
  \include{tables}               % ch 10
  \include{actions}              % ch 11
  \include{match}                % ch 12
  \include{errors}               % ch 13
}{}

\appendix
\include{installation}          % ch 2
\include{syntax}
\include{fieldmaps}
\include{opal-madx}
\include{autophase}
\include{benchmarks}
\include{changelog}

\backmatter
\printbibliography
\printindex
\end{document}