#!/bin/bash
# change [-dm | -ma | -f] <"findStr">  <"replStr"> [<srcFile>]
# 
# changes in all .mad* (-dm) or *.mad9p (-ma) files in 
# the current directory the string findStr into replStr
# The original file is saved under .save[.mad*|*.mad9p]
#
# Examples: 
#           change all .mad* in the current directory
#           % change -dm "MESHPOINTS_X = 64;" "MESHPOINTS_X = 128;"
#
#           change all .mad9p in the current directory
#           % change -ma change -ma "Prot:BEAM, KBUNCH=1, NPART=1e6, GAMMA=gamma, BUNCHED=FALSE, PARTICLE=PROTON,"  \ 
#                                  "Prot:BEAM, KBUNCH=1, NPART=1e7, GAMMA=gamma, BUNCHED=FALSE, PARTICLE=PROTON,"
#
#           change one particular file (.mad-1) 
#           % change -f "MESHPOINTS_X = 128;" "MESHPOINTS_X = 64;" .mad-1 
#
#           rename all *.mad9p files and give them a new (base)name and case-numbers
#           replace the Title,string= ... with <newTitle>
#           % change -ch <newBaseName>
#
#           change string (<strToChange>) in all *.mad9p to <newStr>
#           % change -str <strToChange> <newStr>
#
rm -f *~ .*~ .*.ch 
case "$1" in 
  -dm)
	for file in `ls .mad*`
         do
	  # make script
          echo "awk '{if (\$0 ~ /"$2"/ ) print \"$3\" ; else print \$0}'" $file " >" $file".ch" > t
	  chmod +x ./t
	  ./t
	  cp $file .save$file
	  mv $file.ch $file
	 done
	 ;;
  -ma)
	for file in `ls *.mad9p`
         do
          # make script
          echo "awk '{if (\$0 ~ /"$2"/ ) print \"$3\" ; else print \$0}'" $file " >" $file".ch" > t
	  chmod +x ./t
	  ./t
          cp $file .save$file
	  mv $file.ch $file
	 done
	 ;;
  -f)
        #file=$4
	# make script
        #echo "awk '{if (\$0 ~ /"$2"/ ) print \"$3\" ; else print \$0}'" $file " >" $file".ch" > t
	#chmod +x ./t
	#./t
	#cp $file .save$file
	#mv $file.ch $file
	
	perl -pi -e "s|$2|$3|g" $4
	;;
  -ch)
        num=0
        for file in `ls *.mad9p`
         do
	    num=`expr $num + 1`
	    echo rename $file  to $2-$num.mad9p
	    mv $file $2-$num.mad9p
	 done
        ;;
  -str)
        for file in `ls *.mad9p`
         do
          perl -pi -e "s|$2|$3|g" $file
         done
        ;; 
  -h)
        clear
        head -25 $0
	exit
	;;
    *)
        echo Usage: 'change [-dm | -ma -f] <findStr>  <replStr> [<srcFile>]'
esac
rm -f ./t
