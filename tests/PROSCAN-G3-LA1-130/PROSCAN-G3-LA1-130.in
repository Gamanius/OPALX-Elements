OPTION, ECHO=FALSE;
OPTION, PSDUMPFREQ=50;
OPTION, TELL=TRUE;

// OPAL Input forLA1line
TFast = 5e-11;
TSlow = 5e-12;
TDeg = 1e-12;
Edes = 0.249489;
gamma = (Edes+PMASS)/PMASS;
beta = sqrt(1-(1/gamma^2));
gambet = gamma*beta;
P0 = gamma*beta*PMASS;
brho = (PMASS*1.0e9*gambet) / CLIGHT;
VALUE,{gamma,brho,Edes,beta,gambet};

rf = 50.6328e6;
NProt = 500000;

DISTRIB1: DISTRIBUTION,
SIGMAX = 0.001861, SIGMAPX = 0.001485*gambet,
SIGMAY = 0.001974, SIGMAPY = 0.001291*gambet,
SIGMAZ = 1e-05, SIGMAPZ = 0.0007*gambet,
CORRX = 0.503, CORRY = 0.858, CORRZ = 0,
R51 = 0, R52 = 0, R61 = 0, R62 = 0,
CUTOFFX = 5, CUTOFFPX = 5, CUTOFFY = 5,
CUTOFFPY = 5, CUTOFFLONG = 5, CUTOFFPZ = 5,
OFFSETX = 0.00094113, OFFSETY =-0.002157, OFFSETZ = 0,
DISTRIBUTION = GAUSS, INPUTMOUNITS = NONE;

UPAC: DRIFT, L=0, ELEMEDGE=0;
D1: DRIFT, L=0.3262, ELEMEDGE=0;
D2: DRIFT, L=0.0823, ELEMEDGE=0.3262;
MMAP1X: MONITOR, OUTFN="MMAP1X.h5", ELEMEDGE=0.4085;
MMAP2Y: MONITOR, OUTFN="MMAP2Y.h5", ELEMEDGE=0.4085;
D3: DRIFT, L=0.09, ELEMEDGE=0.4085;
MMAP3X: MONITOR, OUTFN="MMAP3X.h5", ELEMEDGE=0.4985;
MMAP4Y: MONITOR, OUTFN="MMAP4Y.h5", ELEMEDGE=0.4985;
D4: DRIFT, L=0.3075, ELEMEDGE=0.4985;
QMA1: QUADRUPOLE, K1=-16, L=0.368, ELEMEDGE=0.806;
QMA1_r0: ECOLLIMATOR, XSIZE=0.0465, YSIZE=0.0465, L=0.368, ELEMEDGE=0.806;
D5: DRIFT, L=0.294, ELEMEDGE=1.174;
QMA2: QUADRUPOLE, K1=13.092, L=0.368, ELEMEDGE=1.468;
QMA2_r0: ECOLLIMATOR, XSIZE=0.0465, YSIZE=0.0465, L=0.368, ELEMEDGE=1.468;
D6: DRIFT, L=0.324, ELEMEDGE=1.836;
D7: DRIFT, L=0.324, ELEMEDGE=2.16;
QMA3: QUADRUPOLE, K1=-11.7681, L=0.368, ELEMEDGE=2.484;
QMA3_r0: ECOLLIMATOR, XSIZE=0.0465, YSIZE=0.0465, L=0.368, ELEMEDGE=2.484;
D8: DRIFT, L=0.274, ELEMEDGE=2.852;
D9: DRIFT, L=0.164, ELEMEDGE=3.126;
D10: DRIFT, L=0.1875, ELEMEDGE=3.29;
D11: DRIFT, L=0.0815, ELEMEDGE=3.4775;
MMAP5X: MONITOR, OUTFN="MMAP5X.h5", ELEMEDGE=3.559;
MMAP6Y: MONITOR, OUTFN="MMAP6Y.h5", ELEMEDGE=3.559;
D12: DRIFT, L=0.086, ELEMEDGE=3.559;
MMAP7X: MONITOR, OUTFN="MMAP7X.h5", ELEMEDGE=3.645;
MMAP8Y: MONITOR, OUTFN="MMAP8Y.h5", ELEMEDGE=3.645;
Titan1: DRIFT, L=0.000228, ELEMEDGE=3.645;
Air1: DRIFT, L=0.069, ELEMEDGE=3.64523;
D13: DRIFT, L=0.015772, ELEMEDGE=3.71423;
BMA1I: ECOLLIMATOR, XSIZE=0.005, YSIZE=0.005, L=0.002, ELEMEDGE=3.73;
D14: DRIFT, L=0.246, ELEMEDGE=3.732;
BMA1O: ECOLLIMATOR, XSIZE=0.00625, YSIZE=0.00625, L=0.002, ELEMEDGE=3.978;
D15: DRIFT, L=0.02, ELEMEDGE=3.98;

DEGPHYS_Wedge1 :  SURFACEPHYSICS, TYPE="DEGRADER", MATERIAL="GraphiteR6710";

Wedge1: DEGRADER, L=0.0148363, ZSIZE= 0.0148363, OUTFN="Wedge1.h5", SURFACEPHYSICS=DEGPHYS_Wedge1 , ELEMEDGE=4;
Deg_D1: DRIFT, L=0.0114374, ELEMEDGE=4.01484;

Wedge2: DEGRADER, L=0.0296726, ZSIZE= 0.0296726, OUTFN="Wedge2.h5", SURFACEPHYSICS=DEGPHYS_Wedge1 , ELEMEDGE=4.02627;
Deg_D2: DRIFT, L=0.0114374, ELEMEDGE=4.05595;

Wedge3: DEGRADER, L=0.0296726, ZSIZE= 0.0296726, OUTFN="Wedge3.h5", SURFACEPHYSICS=DEGPHYS_Wedge1 , ELEMEDGE=4.06738;
Deg_D3: DRIFT, L=0.0114374, ELEMEDGE=4.09706;

Wedge4: DEGRADER, L=0.0296726, ZSIZE= 0.0296726, OUTFN="Wedge4.h5", SURFACEPHYSICS=DEGPHYS_Wedge1 , ELEMEDGE=4.10849;
Deg_D4: DRIFT, L=0.0114374, ELEMEDGE=4.13817;

Wedge5: DEGRADER, L=0.0296726, ZSIZE= 0.0296726, OUTFN="Wedge5.h5", SURFACEPHYSICS=DEGPHYS_Wedge1 , ELEMEDGE=4.1496;
Deg_D5: DRIFT, L=0.0114374, ELEMEDGE=4.17928;

Wedge6: DEGRADER, L=0.0148363, ZSIZE= 0.0148363, OUTFN="Wedge6.h5", SURFACEPHYSICS=DEGPHYS_Wedge1 , ELEMEDGE=4.19071;
Alumina1: DRIFT, L=0.0003, ELEMEDGE=4.20555;
MDegX: MONITOR, OUTFN="MDegX.h5", ELEMEDGE=4.20585;
MDegY: MONITOR, OUTFN="MDegY.h5", ELEMEDGE=4.20585;
END: DRIFT, L=0.2, ELEMEDGE=4.3;

BEAMLINE_A1: LINE=(UPAC,D1,D2,MMAP1X,MMAP2Y,D3,MMAP3X,MMAP4Y,D4,QMA1,QMA1_r0,D5,QMA2,QMA2_r0,D6,D7,QMA3,QMA3_r0,D8,D9,D10,D11,MMAP5X,MMAP6Y,D12,MMAP7X,MMAP8Y,Titan1,Air1,D13,BMA1I,D14,BMA1O,D15,Wedge1,Deg_D1,Wedge2,Deg_D2,Wedge3,Deg_D3,Wedge4,Deg_D4,Wedge5,Deg_D5,Wedge6,Alumina1,MDegX,MDegY,END);

FS1:FIELDSOLVER, FSTYPE=NONE, MX=64, MY=64, MT=64, PARFFTX=true, PARFFTY=true, PARFFTT=true, BCFFTX=open, BCFFTY=open, BCFFTT=open, BBOXINCR=1, GREENSF=STANDARD;
BEAM_A1: BEAM, PARTICLE=PROTON, PC=P0, NPART=NProt, BCURRENT=NProt*1.6e-19*rf, BFREQ=rf,  CHARGE=1;

STEP0= (0.2262- 0)/(beta*CLIGHT*TFast);
SELECT, LINE=BEAMLINE_A1;
TRACK, LINE=BEAMLINE_A1, BEAM=BEAM_A1, MAXSTEPS= STEP0, DT=TFast;//, ZSTOP=0.2262;
RUN, METHOD = "PARALLEL-T", BEAM=BEAM_A1, FIELDSOLVER=FS1, DISTRIBUTION=DISTRIB1;
ENDTRACK;

STEP1= (0.5985- 0.2262)/(beta*CLIGHT*TSlow);
SELECT, LINE=BEAMLINE_A1;
TRACK, LINE=BEAMLINE_A1, BEAM=BEAM_A1, MAXSTEPS= STEP1, DT=TSlow;//, ZSTOP=0.5985;
RUN, METHOD = "PARALLEL-T", BEAM=BEAM_A1, FIELDSOLVER=FS1, DISTRIBUTION=DISTRIB1;
ENDTRACK;

STEP2= (3.3775- 0.5985)/(beta*CLIGHT*TFast);
SELECT, LINE=BEAMLINE_A1;
TRACK, LINE=BEAMLINE_A1, BEAM=BEAM_A1, MAXSTEPS= STEP2, DT=TFast;//, ZSTOP=3.3775;
RUN, METHOD = "PARALLEL-T", BEAM=BEAM_A1, FIELDSOLVER=FS1, DISTRIBUTION=DISTRIB1;
ENDTRACK;

STEP3= (3.99-4.3)/(beta*CLIGHT*TDeg);
SELECT, LINE=BEAMLINE_A1;
TRACK, LINE=BEAMLINE_A1, BEAM=BEAM_A1, MAXSTEPS= 10000, DT=TSlow, ZSTOP=4.5;
RUN, METHOD = "PARALLEL-T", BEAM=BEAM_A1, FIELDSOLVER=FS1, DISTRIBUTION=DISTRIB1;
ENDTRACK;

STOP;
