OPTION, ECHO=FALSE;
OPTION, INFO=TRUE;
OPTION, VERSION=10900;

TITLE, STRING="MAP Test";

REAL Edes   = 0.10;
REAL gamma  = (Edes+PMASS)/PMASS;
REAL beta   = sqrt(1-(1/gamma^2));
REAL gambet = gamma*beta;
REAL P0     = gamma*beta*PMASS;
REAL brho   = (PMASS*1.0e9*gambet) / CLIGHT;
REAL rf     = 50.6328e6;  //need to be confirmed

VALUE,{gamma,brho,Edes,beta,gambet};

QP1: QUADRUPOLE, L=1.0, K1= 2.00, ELEMEDGE=0.000, NSLICES=3;
QP2: QUADRUPOLE, L=1.0, K1=-3.00, ELEMEDGE=1.000;
QP3: QUADRUPOLE, L=1.0, K1= 4.00, ELEMEDGE=2.000, NSLICES=4;


D: DRIFT, L=2.0, ELEMEDGE=3.000, NSLICES=4;

//BENDS: RBend, K0 = 1.000, FMAPFN = "1DPROFILE1-DEFAULT", ELEMEDGE = 5.0, DESIGNENERGY = Edes*1e3, L = 1.0, GAP = 0.02;

BENDS: SBend,   ANGLE = 30.0*Pi / 180.0, FMAPFN = "1DPROFILE1-DEFAULT", ELEMEDGE = 5.0, DESIGNENERGY = Edes*1e3, L = 1.0, GAP = 0.02;


//As an example for a sextupole
S11: SEXTUPOLE, L=0.4, K2=0.00134, ELEMEDGE=4.000;

//QUADTEST: LINE=( QP1, QP2, D, QP3);
QUADTEST: LINE=( QP1, QP2, D, QP3 );

D1: DISTRIBUTION, TYPE=GAUSS,
SIGMAX=  5*1.0e-03,   SIGMAPX= 0.696*1.0e06,  CORRX= 0.0,
SIGMAY=  5*1.0e-03,   SIGMAPY= 0.310*1.0e06,  CORRY= 0.0,
OFFSETZ     =  0.005,        SIGMAT= 0.0005, 
SIGMAPT= 0.0, CORRT= 0.0, R61= 0.0, INPUTMOUNITS=EV;

FS1:FIELDSOLVER, FSTYPE=NONE, MX=64, MY=64, MT=64, 
                 PARFFTX=true, PARFFTY=true, PARFFTT=true,
                 BCFFTX=open, BCFFTY=open, BCFFTT=open, 
                 BBOXINCR=1, GREENSF=STANDARD;

BEAM1: BEAM, PARTICLE=PROTON, PC=P0, NPART=1000, BCURRENT=2.0e-03, BFREQ=rf, CHARGE=1;

SELECT, LINE=QUADTEST;

TRACK, LINE=QUADTEST, BEAM=BEAM1, MAXSTEPS=1, DT=1.0e-11, ZSTOP=8.0;

RUN, METHOD = "THICK", BEAM=BEAM1, FIELDSOLVER=FS1, DISTRIBUTION=D1;
ENDTRACK;

STOP;
