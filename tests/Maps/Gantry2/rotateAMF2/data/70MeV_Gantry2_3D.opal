
OPTION, ECHO=FALSE;
OPTION, INFO=TRUE;
OPTION, VERSION=10900;
OPTION, STATDUMPFREQ=10;
OPTION, PSDUMPFREQ=1000;

REAL Coll_b4gap_size=0.0180;

REAL Coll_aftrgap_size=0.0140;

REAL Coll_atgap_size = 0.005;

REAL NProt = 1000;

REAL TFast = 1e-11;
REAL TSlow = 1e-12;
REAL TNozzSlow = 1e-12;

REAL TDeg = 1e-12;
REAL Edes = 0.07381;
REAL gamma = (Edes+PMASS)/PMASS;
REAL beta = sqrt(1-(1/gamma^2));
REAL gambet = gamma*beta;
REAL P0 = gamma*beta*PMASS;
REAL brho = (PMASS*1.0e9*gambet) / CLIGHT;

VALUE,{gamma,brho,Edes,beta,gambet};

REAL rf = 50.6328e6;

REAL fact_x  =1.400;
REAL fact_xd =1.40;
REAL fact_y  =1.400;
REAL fact_yd =1.40;
REAL fact_delp=2.30;

DISTRIB1: DISTRIBUTION, 	TYPE=GAUSS,
	SIGMAX = 0.00253256*fact_x,     SIGMAPX = 0.00231138*gambet*fact_xd  ,	SIGMAY = 0.00938593*fact_y,     SIGMAPY = 0.00161825*gambet*fact_yd ,	SIGMAZ = 0.00970918*0.000001,      SIGMAPZ = 0.00171298*gambet*fact_delp  ,	CORRX =  0.858145,       CORRY =  0.967638,      CORRZ =  0.999981,	R51 =  -0.00957565,      R52 =  0.103166,        R61 =  -0.0074746,      R62 =  0.105198,
	CUTOFFX = 5, CUTOFFPX = 5, CUTOFFY = 5,	CUTOFFPY = 5, CUTOFFLONG = 5, CUTOFFPZ = 5,	OFFSETX = 0, OFFSETY =0, OFFSETZ = 0,	INPUTMOUNITS = NONE;

D67: DRIFT, L=0.9, ELEMEDGE=31.532;

D69: DRIFT, L=0.196, Z = 32.436;
QMB3: QUADRUPOLE, K1=-3.67009, L=0.368, Z = 32.632;

D70: DRIFT, L=0.202, Z = 33.0;
QMB4: QUADRUPOLE, K1=6.26124, L=0.368, Z = 33.202;

D71: DRIFT, L=0.202, Z = 33.57;
QMB5: QUADRUPOLE, K1=-3.333, L=0.368, Z = 33.772;

D71A: DRIFT, L=0.3175, Z = 34.14;
MMBP7X: MONITOR, OUTFN="MMBP7X.h5", Z = 34.4525;
MMBP8Y: MONITOR, OUTFN="MMBP8Y.h5", Z = 34.4525;

D72: DRIFT, L=0.04250, Z = 34.4575;
 
Mon_Coll_b4gap: MONITOR, OUTFN="Mon_Coll_beforeGap.h5", ELEMEDGE=34.50+0.050;
		
SMB3: DRIFT, L=0.45380, Z = 34.56;
  
D73: DRIFT, L=1.0442, Z = 35.0138;

D74A: DRIFT, L=0.044, Z = 36.133;
Myl3: DRIFT, L=0.000122, Z = 36.177;
D74B: DRIFT, L=0.02, Z = 36.1771;
MMBP9X: MONITOR, OUTFN="MMBP9X.h5", Z = 36.1921;
MMBP10Y: MONITOR, OUTFN="MMBP10Y.h5", Z = 36.1921;

Mon_Coll_atgap: MONITOR, OUTFN="Mon_Coll_atGap.h5", ELEMEDGE=36.2071+0.050+0.010;

UPG2A: DRIFT, L=0.02550, Z = 36.2671;
	
UPG2X: MONITOR, OUTFN="UPG2X.h5", Z = 36.2876;
UPG2Y: MONITOR, OUTFN="UPG2Y.h5", Z = 36.2876;
UPG2B: DRIFT, L=0.0335, Z = 36.2926;

D76: DRIFT, L=0.015, Z = 36.3301;
Titan: DRIFT, L=3e-05, ELEMEDGE=36.3451;
D77: DRIFT, L=0.064, Z = 36.3451;
D78: DRIFT, L=0.0925, Z = 36.4091;

Deg: DRIFT, L=0.40, Z = 36.5016;
Myl4: DRIFT, L=0.0001, Z = 36.9016;
D79: DRIFT, L=0.1455, Z = 36.9017;
D80: DRIFT, L=0.3245, Z = 37.0472;
MMFP1X: MONITOR, OUTFN="MMFP1X.h5", Z = 37.3667;
MMFP2Y: MONITOR, OUTFN="MMFP2Y.h5", Z = 37.3667;

D81a: DRIFT, L=0.160, Z = 37.3717;
 
Mon_Coll_aftrgap: MONITOR, OUTFN="Mon_Coll_afterGap.h5", ELEMEDGE=37.5317+0.050+0.010;
	
D81b: DRIFT, L=0.0585, Z = 37.5917;
						
QMF1: QUADRUPOLE, K1=-4.22518, L=0.32, Z = 37.6502;

QMFC: DRIFT, L=0.155, Z = 37.9702;
D82: DRIFT, L=0.155, Z = 38.1252;
QMF2: QUADRUPOLE, K1=4.73565, L=0.32, Z = 38.2802;

D83: DRIFT, L=0.436, Z = 38.6002;
AMF1: SBEND, K0=0.804307, L=1.4929, Z = 39.0362,
        FMAPFN="HardEdge.T7",         DESIGNENERGY=7.381e+01, GAP=.2;

D84: DRIFT, L=0.395, X = -0.7109070014, Z = 40.3522060664, THETA = 303.361656 * PI / 180;
MMFP3X: MONITOR, OUTFN="MMFP3X.h5", X = -1.0366412716, Z = 40.5666756101, THETA = 303.361656 * PI / 180;
MMFP4Y: MONITOR, OUTFN="MMFP4Y.h5", X = -1.0366412716, Z = 40.5666756101, THETA = 303.361656 * PI / 180;
D86: DRIFT, L=0.2667, X = -1.0408173520, Z = 40.5694252197, THETA = 303.361656 * PI / 180;
QMF3: QUADRUPOLE, K1=-4.21226, L=0.32, X = -1.2635694798, Z = 40.7160893923, THETA = 303.361656 * PI / 180;

SMF2: DRIFT, L=0.17, X = -1.5308386247, Z = 40.8920644025, THETA = 303.361656 * PI / 180;
D87: DRIFT, L=0.17, X = -1.6728253578, Z = 40.9855511267, THETA = 303.361656 * PI / 180;
QMF4: QUADRUPOLE, K1=5.77077, L=0.32, X = -1.814812091, Z = 41.0790378509, THETA = 303.361656 * PI / 180;

D88: DRIFT, L=0.425, X = -2.0820812358, Z = 41.2550128612, THETA = 303.361656 * PI / 180;

AMF2: SBEND, 		 K0=0.804017, L=1.4929, 		 X = -2.4370480688, Z = 41.4887296717, THETA = 303.361656 * PI / 180, PSI = 180.0 * PI / 180,
        FMAPFN="HardEdge.T7",                  DESIGNENERGY=7.381e+01, GAP=.1;

D89: DRIFT, L=0.395, X = -3.1460609137, Z = 44.2219380675, THETA = 359.977736 * PI / 180;
MMFP5X: MONITOR, OUTFN="MMFP5X.h5", X = -3.1462124571, Z = 44.6119380381, THETA = 359.977736 * PI / 180;
MMFP6Y: MONITOR, OUTFN="MMFP6Y.h5", X = -3.1462124571, Z = 44.6119380381, THETA = 359.977736 * PI / 180;
SMF3: DRIFT, L=0.3446, X = -3.1462144000, Z = 44.6169380377, THETA = 359.977736 * PI / 180;
D92: DRIFT, L=0.1269, X = -3.1463483022, Z = 44.9615380117, THETA = 359.977736 * PI / 180;
QMF5: QUADRUPOLE, K1=0.0590979, L=0.32, X = -3.146397612, Z = 45.0884380021, THETA = 359.977736 * PI / 180;

D93: DRIFT, L=0.14, X = -3.1465219554, Z = 45.4084379780, THETA = 359.977736 * PI / 180;
QMF6: QUADRUPOLE, K1=6.0462, L=0.32, X = -3.1465763556, Z = 45.5484379674, THETA = 359.977736 * PI / 180;

D94: DRIFT, L=0.14, X = -3.1467006989, Z = 45.8684379432, THETA = 359.977736 * PI / 180;
QMF7: QUADRUPOLE, K1=-4.66959, L=0.32, X = -3.146755099, Z = 46.0084379327, THETA = 359.977736 * PI / 180;

D95: DRIFT, L=0.264, X = -3.1468794424, Z = 46.3284379085, THETA = 359.977736 * PI / 180;
WMFT: DRIFT, L=0.2, X = -3.1469820256, Z = 46.5924378886, THETA = 359.977736 * PI / 180;
D96: DRIFT, L=0.18, X = -3.1470597402, Z = 46.7924378735, THETA = 359.977736 * PI / 180;
WMFU: DRIFT, L=0.34, X = -3.1471296833, Z = 46.9724378599, THETA = 359.977736 * PI / 180;
D97: DRIFT, L=0.5473, X = -3.147261798, Z = 47.3124378342, THETA = 359.977736 * PI / 180;

AMF3: SBEND, K0=-0.811531, L=2.17747, X = -3.1474744639, Z = 47.8597377929, THETA = 359.977736 * PI / 180, PSI = 180.0 * PI / 180,
        FMAPFN="HardEdge.T7",
         DESIGNENERGY=7.381e+01, GAP=75*2/1000;

D98ext: DRIFT, L=0.373420, X = 1.4197296994, Z = 49.497477806, THETA = 88.531390 * PI / 180;
 
Mon_D98extX: MONITOR, OUTFN="Mon_D98extX.h5", X = 1.7880286794, Z = 49.5069201433, THETA = 88.531390 * PI / 180;
Mon_D98extY: MONITOR, OUTFN="Mon_D98extX.h5", X = 1.7880286794, Z = 49.5069201433, THETA = 88.531390 * PI / 180;

REAL ExtendedLength   =0.2600 ;
 REAL Mylar_thick175mm = 0.000175;
REAL Mylar_thick      = 2e-5;

REAL total_Mylaar_thick =Mylar_thick175mm + (10*2e-5);
 
D100a_vac: Drift, L=0.354560, ELEMEDGE=50.65242;
 
Mylar_win1: Drift, L=total_Mylaar_thick, ELEMEDGE=51.006980;

REAL Len_air  = ExtendedLength + (0.427874 - 2e-4) + (0.470688 - 0.150);
REAL edge_air = 51.006980 + total_Mylaar_thick;

D100b_air: Drift, L=Len_air , ELEMEDGE=edge_air ;
 
Drift_isoa: Drift, L=0.150, ELEMEDGE= 51.006980+Len_air+total_Mylaar_thick;
 Mon_ISO: MONITOR, X = 3.3033277647, Z = 49.5457689205, THETA = 88.531390 * PI / 180,  OUTFN="Mon_ISO.h5";
Drift_isob: Drift, L=0.200, ELEMEDGE=edge_air + Len_air + 0.150;
 
Nozz_air: LINE=( D100a_vac, Mylar_win1, D100b_air, Drift_isoa, Mon_ISO, Drift_isob);

BEAMLINE_G2: LINE=(
D69,QMB3,
D70,QMB4,
D71,QMB5,
D71A,MMBP7X,MMBP8Y,D72,
SMB3,D73,
D74A,Myl3,D74B,MMBP9X,MMBP10Y,
UPG2A,UPG2X,UPG2Y,UPG2B,
D76,
D77,D78,Deg,Myl4, D79,D80,MMFP1X,MMFP2Y,D81a, 
D81b,QMF1,
QMFC,D82,QMF2,
D83,AMF1,
D84,MMFP3X,MMFP4Y,D86,QMF3,
SMF2,D87,QMF4,
D88,AMF2, 
D89,MMFP5X,MMFP6Y,SMF3,D92,QMF5,
D93,QMF6,
D94,QMF7,
D95,WMFT,D96,WMFU,D97,AMF3,
D98ext,Mon_D98extX,Mon_D98extY,Mon_ISO);
  
FS1:FIELDSOLVER, FSTYPE=NONE, MX=64, MY=64, MT=64, PARFFTX=true, PARFFTY=false, PARFFTT=false, BCFFTX=open, BCFFTY=open, BCFFTT=open, BBOXINCR=1, GREENSF=STANDARD;
BEAM_G2: BEAM, PARTICLE=PROTON, PC=P0, NPART=NProt, BCURRENT=NProt*1.6e-19*rf, BFREQ=rf,  CHARGE=1;

REAL STEP02= 100./(beta*CLIGHT*TSlow);
SELECT, LINE=BEAMLINE_G2;
TRACK, LINE=BEAMLINE_G2, BEAM=BEAM_G2, MAXSTEPS= STEP02, DT=TNozzSlow, ZSTART=31.5926, ZSTOP=52.50;

RUN, METHOD = "Parallel-T", BEAM=BEAM_G2, FIELDSOLVER=FS1, DISTRIBUTION=DISTRIB1;
ENDTRACK;

STOP;


