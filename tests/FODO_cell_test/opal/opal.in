OPTION, PSDUMPFREQ = 1;   // 6d data written every 300000 time steps (h5).
OPTION, STATDUMPFREQ = 1;  // Beam Stats written every 10 time steps (stat).
OPTION, BOUNDPDESTROYFQ=10; // Delete lost particles, if any
OPTION, AUTOPHASE=4;        // Autophase is on, and phase of max energy
                            // gain will be found automatically for cavities
Option, VERSION=10900;

Title, string="Solenoid-1 test";

//----------------------------------------------------------------------------
//Global Parameters

REAL rf_freq             = 1.3e3;     //RF frequency. (Hz)
REAL n_particles         = 1E4;      //Number of particles in simulation.
REAL beam_bunch_charge   = 1e-9;      //Charge of bunch. (C)

//Initial Momentum Calculation
REAL Edes    = 1e-3;  // initial energy in GeV
REAL gamma   = (Edes+EMASS)/EMASS;
REAL beta    = sqrt(1-(1/gamma^2));
REAL P0      = gamma*beta*EMASS;    //inital z momentum

//Printing initial energy and momentum to terminal output.
value , {Edes, P0, OPALVERSION};

//----------------------------------------------------------------------------
// Solenoids
//
// L:           Physcial element length (m)
// ELEMEDGE:    Physcial start of element (m)
// KS:          Solenoid strength (Rad/m)
// FMAPFM:      Field file (string)

// Note: OPAL scales the field file based on the max magnetic
// field value in the file, not Bz on axis. The max field
// value is normalized to 1 [T], and scaled with KS.
// i.e. The max value in the BF_559 file = 0.162544398 [T].
// Therefore, setting KS = 0.162544398 runs the magnet at max current.

FOCUS_POLE_0  : MULTIPOLE, L=0.1, ELEMEDGE=0.000, KN={0, 0.1};
FIRST_DRIFT_0 : DRIFT    , L=0.5, ELEMEDGE=0.100;
DEFOCUS_POLE_0: MULTIPOLE, L=0.1, ELEMEDGE=0.600, KN={0, -0.1};
SECOND_DRIFT_0: DRIFT    , L=0.5, ELEMEDGE=0.700;


FOCUS_POLE_1  : MULTIPOLE, L=0.1, ELEMEDGE=1.200, KN={0, 0.1};
FIRST_DRIFT_1 : DRIFT    , L=0.5, ELEMEDGE=1.300;
DEFOCUS_POLE_1: MULTIPOLE, L=0.1, ELEMEDGE=1.800, KN={0, -0.1};
SECOND_DRIFT_1: DRIFT    , L=0.5, ELEMEDGE=1.900;


FOCUS_POLE_2  : MULTIPOLE, L=0.1, ELEMEDGE=2.400, KN={0, 0.1};
FIRST_DRIFT_2 : DRIFT    , L=0.5, ELEMEDGE=2.500;
DEFOCUS_POLE_2: MULTIPOLE, L=0.1, ELEMEDGE=3.000, KN={0, -0.1};
SECOND_DRIFT_2: DRIFT    , L=0.5, ELEMEDGE=3.100;


FOCUS_POLE_3  : MULTIPOLE, L=0.1, ELEMEDGE=3.600, KN={0, 0.1};
FIRST_DRIFT_3 : DRIFT    , L=0.5, ELEMEDGE=3.700;
DEFOCUS_POLE_3: MULTIPOLE, L=0.1, ELEMEDGE=4.200, KN={0, -0.1};
SECOND_DRIFT_3: DRIFT    , L=0.5, ELEMEDGE=4.300;


FOCUS_POLE_4  : MULTIPOLE, L=0.1, ELEMEDGE=4.800, KN={0, 0.1};
FIRST_DRIFT_4 : DRIFT    , L=0.5, ELEMEDGE=4.900;
DEFOCUS_POLE_4: MULTIPOLE, L=0.1, ELEMEDGE=5.400, KN={0, -0.1};
SECOND_DRIFT_4: DRIFT    , L=0.5, ELEMEDGE=5.500;


FOCUS_POLE_5  : MULTIPOLE, L=0.1, ELEMEDGE=6.000, KN={0, 0.1};
FIRST_DRIFT_5 : DRIFT    , L=0.5, ELEMEDGE=6.100;
DEFOCUS_POLE_5: MULTIPOLE, L=0.1, ELEMEDGE=6.600, KN={0, -0.1};
SECOND_DRIFT_5: DRIFT    , L=0.5, ELEMEDGE=6.700;


FOCUS_POLE_6  : MULTIPOLE, L=0.1, ELEMEDGE=7.200, KN={0, 0.1};
FIRST_DRIFT_6 : DRIFT    , L=0.5, ELEMEDGE=7.300;
DEFOCUS_POLE_6: MULTIPOLE, L=0.1, ELEMEDGE=7.800, KN={0, -0.1};
SECOND_DRIFT_6: DRIFT    , L=0.5, ELEMEDGE=7.900;


FOCUS_POLE_7  : MULTIPOLE, L=0.1, ELEMEDGE=8.400, KN={0, 0.1};
FIRST_DRIFT_7 : DRIFT    , L=0.5, ELEMEDGE=8.500;
DEFOCUS_POLE_7: MULTIPOLE, L=0.1, ELEMEDGE=9.000, KN={0, -0.1};
SECOND_DRIFT_7: DRIFT    , L=0.5, ELEMEDGE=9.100;


FOCUS_POLE_8  : MULTIPOLE, L=0.1, ELEMEDGE=9.600, KN={0, 0.1};
FIRST_DRIFT_8 : DRIFT    , L=0.5, ELEMEDGE=9.700;
DEFOCUS_POLE_8: MULTIPOLE, L=0.1, ELEMEDGE=10.200, KN={0, -0.1};
SECOND_DRIFT_8: DRIFT    , L=0.5, ELEMEDGE=10.300;


FOCUS_POLE_9  : MULTIPOLE, L=0.1, ELEMEDGE=10.800, KN={0, 0.1};
FIRST_DRIFT_9 : DRIFT    , L=0.5, ELEMEDGE=10.900;
DEFOCUS_POLE_9: MULTIPOLE, L=0.1, ELEMEDGE=11.400, KN={0, -0.1};
SECOND_DRIFT_9: DRIFT    , L=0.5, ELEMEDGE=11.500;


FOCUS_POLE_10  : MULTIPOLE, L=0.1, ELEMEDGE=12.000, KN={0, 0.1};
FIRST_DRIFT_10 : DRIFT    , L=0.5, ELEMEDGE=12.100;
DEFOCUS_POLE_10: MULTIPOLE, L=0.1, ELEMEDGE=12.600, KN={0, -0.1};
SECOND_DRIFT_10: DRIFT    , L=0.5, ELEMEDGE=12.700;


FOCUS_POLE_11  : MULTIPOLE, L=0.1, ELEMEDGE=13.200, KN={0, 0.1};
FIRST_DRIFT_11 : DRIFT    , L=0.5, ELEMEDGE=13.300;
DEFOCUS_POLE_11: MULTIPOLE, L=0.1, ELEMEDGE=13.800, KN={0, -0.1};
SECOND_DRIFT_11: DRIFT    , L=0.5, ELEMEDGE=13.900;


FOCUS_POLE_12  : MULTIPOLE, L=0.1, ELEMEDGE=14.400, KN={0, 0.1};
FIRST_DRIFT_12 : DRIFT    , L=0.5, ELEMEDGE=14.500;
DEFOCUS_POLE_12: MULTIPOLE, L=0.1, ELEMEDGE=15.000, KN={0, -0.1};
SECOND_DRIFT_12: DRIFT    , L=0.5, ELEMEDGE=15.100;


FOCUS_POLE_13  : MULTIPOLE, L=0.1, ELEMEDGE=15.600, KN={0, 0.1};
FIRST_DRIFT_13 : DRIFT    , L=0.5, ELEMEDGE=15.700;
DEFOCUS_POLE_13: MULTIPOLE, L=0.1, ELEMEDGE=16.200, KN={0, -0.1};
SECOND_DRIFT_13: DRIFT    , L=0.5, ELEMEDGE=16.300;


FOCUS_POLE_14  : MULTIPOLE, L=0.1, ELEMEDGE=16.800, KN={0, 0.1};
FIRST_DRIFT_14 : DRIFT    , L=0.5, ELEMEDGE=16.900;
DEFOCUS_POLE_14: MULTIPOLE, L=0.1, ELEMEDGE=17.400, KN={0, -0.1};
SECOND_DRIFT_14: DRIFT    , L=0.5, ELEMEDGE=17.500;


FOCUS_POLE_15  : MULTIPOLE, L=0.1, ELEMEDGE=18.000, KN={0, 0.1};
FIRST_DRIFT_15 : DRIFT    , L=0.5, ELEMEDGE=18.100;
DEFOCUS_POLE_15: MULTIPOLE, L=0.1, ELEMEDGE=18.600, KN={0, -0.1};
SECOND_DRIFT_15: DRIFT    , L=0.5, ELEMEDGE=18.700;


FOCUS_POLE_16  : MULTIPOLE, L=0.1, ELEMEDGE=19.200, KN={0, 0.1};
FIRST_DRIFT_16 : DRIFT    , L=0.5, ELEMEDGE=19.300;
DEFOCUS_POLE_16: MULTIPOLE, L=0.1, ELEMEDGE=19.800, KN={0, -0.1};
SECOND_DRIFT_16: DRIFT    , L=0.5, ELEMEDGE=19.900;


FOCUS_POLE_17  : MULTIPOLE, L=0.1, ELEMEDGE=20.400, KN={0, 0.1};
FIRST_DRIFT_17 : DRIFT    , L=0.5, ELEMEDGE=20.500;
DEFOCUS_POLE_17: MULTIPOLE, L=0.1, ELEMEDGE=21.000, KN={0, -0.1};
SECOND_DRIFT_17: DRIFT    , L=0.5, ELEMEDGE=21.100;


FOCUS_POLE_18  : MULTIPOLE, L=0.1, ELEMEDGE=21.600, KN={0, 0.1};
FIRST_DRIFT_18 : DRIFT    , L=0.5, ELEMEDGE=21.700;
DEFOCUS_POLE_18: MULTIPOLE, L=0.1, ELEMEDGE=22.200, KN={0, -0.1};
SECOND_DRIFT_18: DRIFT    , L=0.5, ELEMEDGE=22.300;


FOCUS_POLE_19  : MULTIPOLE, L=0.1, ELEMEDGE=22.800, KN={0, 0.1};
FIRST_DRIFT_19 : DRIFT    , L=0.5, ELEMEDGE=22.900;
DEFOCUS_POLE_19: MULTIPOLE, L=0.1, ELEMEDGE=23.400, KN={0, -0.1};
SECOND_DRIFT_19: DRIFT    , L=0.5, ELEMEDGE=23.500;


SOLine: Line = (
FOCUS_POLE_0, FIRST_DRIFT_0, DEFOCUS_POLE_0, SECOND_DRIFT_0,
FOCUS_POLE_1, FIRST_DRIFT_1, DEFOCUS_POLE_1, SECOND_DRIFT_1,
FOCUS_POLE_2, FIRST_DRIFT_2, DEFOCUS_POLE_2, SECOND_DRIFT_2,
FOCUS_POLE_3, FIRST_DRIFT_3, DEFOCUS_POLE_3, SECOND_DRIFT_3,
FOCUS_POLE_4, FIRST_DRIFT_4, DEFOCUS_POLE_4, SECOND_DRIFT_4,
FOCUS_POLE_5, FIRST_DRIFT_5, DEFOCUS_POLE_5, SECOND_DRIFT_5,
FOCUS_POLE_6, FIRST_DRIFT_6, DEFOCUS_POLE_6, SECOND_DRIFT_6,
FOCUS_POLE_7, FIRST_DRIFT_7, DEFOCUS_POLE_7, SECOND_DRIFT_7,
FOCUS_POLE_8, FIRST_DRIFT_8, DEFOCUS_POLE_8, SECOND_DRIFT_8,
FOCUS_POLE_9, FIRST_DRIFT_9, DEFOCUS_POLE_9, SECOND_DRIFT_9,
FOCUS_POLE_10, FIRST_DRIFT_10, DEFOCUS_POLE_10, SECOND_DRIFT_10,
FOCUS_POLE_11, FIRST_DRIFT_11, DEFOCUS_POLE_11, SECOND_DRIFT_11,
FOCUS_POLE_12, FIRST_DRIFT_12, DEFOCUS_POLE_12, SECOND_DRIFT_12,
FOCUS_POLE_13, FIRST_DRIFT_13, DEFOCUS_POLE_13, SECOND_DRIFT_13,
FOCUS_POLE_14, FIRST_DRIFT_14, DEFOCUS_POLE_14, SECOND_DRIFT_14,
FOCUS_POLE_15, FIRST_DRIFT_15, DEFOCUS_POLE_15, SECOND_DRIFT_15,
FOCUS_POLE_16, FIRST_DRIFT_16, DEFOCUS_POLE_16, SECOND_DRIFT_16,
FOCUS_POLE_17, FIRST_DRIFT_17, DEFOCUS_POLE_17, SECOND_DRIFT_17,
FOCUS_POLE_18, FIRST_DRIFT_18, DEFOCUS_POLE_18, SECOND_DRIFT_18,
FOCUS_POLE_19, FIRST_DRIFT_19, DEFOCUS_POLE_19, SECOND_DRIFT_19
);

Dist: DISTRIBUTION, TYPE = GAUSS,
        SIGMAX = 0.001,
        SIGMAY = 0.001,
	SIGMAZ = 0.001;

//----------------------------------------------------------------------------
// Define Field solvers
// The mesh sizes should be a factor of 2
// for most efficient space charge calculation.

FS_SC: Fieldsolver, FSTYPE = NONE,
            MX = 16, MY = 16, MT = 16, // SC grid size is 32^3
            PARFFTX = false,
            PARFFTY = false,
            PARFFTT = true,  // parallel in the z direction only
            BCFFTX = open,
            BCFFTY = open,
            BCFFTT = open,
            BBOXINCR = 1,
            GREENSF = INTEGRATED;

//----------------------------------------------------------------------------
// Electron Beam Definition

BEAM1:  BEAM, PARTICLE = ELECTRON, pc = P0, NPART = n_particles,
        BFREQ = rf_freq, BCURRENT = beam_bunch_charge * rf_freq * 1e6, CHARGE = -1;

//----------------------------------------------------------------------------
// Simulate the beamline using TRACK and RUN.
// Note, different time steps are set based on the z location in the beam line.
// In the case below, 1.0e-13 is used for 0.0 to 0.4 m,
// and 3.0e-12 is used from 0.4 to 5 m.

TRACK, LINE = SOLine, BEAM = BEAM1, MAXSTEPS = 8510, DT = {1e-11};
RUN, METHOD = "PARALLEL-T", BEAM = BEAM1,
    FIELDSOLVER = FS_SC, DISTRIBUTION = Dist;
ENDTRACK;
Quit;